{"ast":null,"code":"import popup from '../components/popup';\nimport store from '../store/index';\nimport axios from \"axios\";\nimport liff from '@line/liff';\nimport swal from 'sweetalert2';\nexport default {\n  name: 'formBox',\n  props: ['tab', 'cloudInvoice'],\n  components: {\n    popup\n  },\n  data: () => ({\n    dialog: false,\n    popupIconType: '',\n    popupItem: '',\n    prize: '',\n    valid: true,\n    showVerifyCode: false,\n    form: {\n      inv_type: '',\n      carrierNo: '',\n      //載具手機條碼\n      verifyCode: '',\n      //載具手機條碼 驗證碼(密碼)\n      inv_number: '',\n      //發票號碼\n      inv_randomNumber: '',\n      //隨機碼\n      file_inv_photo: '',\n      //上傳發票明細\n      buyCity: '',\n      //購買城市\n      inv_date: '',\n      //發票日期\n      buyCategory: [],\n      //購買品項\n      name: '',\n      gender: '男',\n      mobile: '',\n      email: '',\n      liveCity: '',\n      //居住城市\n      gCAPTCHA_token: '',\n      scanning: '' //QR Code裡的資料\n    },\n\n    rules: {\n      carrierNo: [v => !!v || '請輸入手機條碼(載具)', v => /^\\/[0-9A-Z.+-]{7}$/.test(v) || '格式錯誤'],\n      // - 需放最後，不然要會跟 0-9 的 - 混淆\n      verifyCode: [v => !!v || '請輸入驗證碼(密碼)'],\n      inv_number: [v => !!v || '請輸入發票號碼', v => /^[A-Z]{2}[0-9]{8}$/.test(v) || '格式錯誤'],\n      inv_randomNumber: [v => !!v && v.length == 4 || '請輸入四位隨機碼'],\n      file_inv_photo: [v => !!v || '請上傳發票明細'],\n      inv_date: [v => !!v || '請選擇發票日期'],\n      buyCategory: [v => !!v && v.length > 0 || '請選擇至少一個購買品項'],\n      name: [v => !!v || '請輸入姓名'],\n      liveCity: [v => !!v || '請輸入居住城市'],\n      buyCity: [v => !!v || '請輸入購買城市'],\n      mobile: [v => !!v || '請輸入十位手機號碼', v => /^[0-9]{10}$/.test(v) || '格式錯誤'],\n      email: [v => !!v || '請輸入電子信箱', v => /.+@.+\\..+/.test(v) || '格式錯誤']\n    },\n    select: '隨機碼',\n    items: ['隨機碼', '上傳發票明細'],\n    checkbox: '',\n    scanningCheck: false //掃描QR Code成功\n  }),\n\n  computed: {\n    cityItems() {\n      // 城市list\n      return store.state.cityItems;\n    },\n    buyItem() {\n      //購買品項\n      return store.state.buyItem;\n    },\n    fromTags() {\n      //愛酷標籤\n      return store.state.fromTags;\n    }\n  },\n  watch: {\n    'cloudInvoice': function () {\n      // 清空表單\n      let me = this;\n      me.$refs.form.reset();\n      this.$nextTick(function () {\n        me.form.gender = '男';\n        me.select = \"隨機碼\";\n        me.inv_number = ''; //發票號碼\n        me.inv_date = ''; //發票日期\n        me.form.buyCity = ''; //購買城市\n        me.form.liveCity = ''; //居住城市\n        me.scanningCheck = false;\n      });\n    },\n    'form.scanning': function (val) {\n      // 檢查qr code的內容\n      if (/^[A-Z]{2}[0-9]{8}/.test(val)) {\n        // qr code輸入正確\n        this.form.inv_number = this.form.scanning.substring(0, 10); //發票號碼\n        let yyymmmddd = this.form.scanning.substring(10, 17); //發票日期\n        let yyy = yyymmmddd.substring(0, 3); //年\n        let mm = yyymmmddd.substring(3, 5); //月\n        let dd = yyymmmddd.substring(5, 7); //日\n        this.form.inv_date = 1911 + Number(yyy) + '-' + mm + '-' + dd;\n        this.form.inv_randomNumber = this.form.scanning.substring(17, 21); //隨機碼\n        this.scanningCheck = true;\n      } else {\n        // qr code不正確\n        swal.fire({\n          text: JSON.stringify('請重新掃描qr code'),\n          // text: JSON.stringify(val),\n          allowOutsideClick: false\n        });\n      }\n    }\n  },\n  mounted() {},\n  methods: {\n    Lazy() {\n      // 填寫假資料 \n      // this.form.carrierNo = '/aaaaaaa', //載具手機條碼\n      // this.form.verifyCode = '111111', //載具手機條碼 驗證碼(密碼)\n      // this.form.inv_number = \"CC22222222\"; //發票號碼\n      // this.form.inv_randomNumber = \"2222\"; //隨機碼\n      // this.form.inv_date = '2022-11-11'; //發票日期\n      this.form.buyCity = '臺北市'; //購買城市\n      this.form.name = '假資料';\n      this.form.gender = '男';\n      this.form.mobile = '0912345678';\n      this.form.email = 'qwe@ee.ee';\n      this.form.liveCity = '臺北市'; //居住城市\n      this.form.buyCategory = ['春風抽取式和捲筒式', '春風1秒抽和捲筒廚紙'];\n      this.checkbox = true;\n    },\n    // 清除測試站user本人帳號的所有資料\n    toneClear() {\n      var me = this;\n      me.url = '/API/ExecJob_Reset/86A874CB1A1241E48A902909908EC8A3';\n      var config = {\n        method: \"post\",\n        headers: {\n          Authorization: `Bearer ${me.$accessToken}`\n        },\n        url: me.$apiUrl + me.url\n      };\n      swal.fire({\n        didOpen: () => {\n          swal.fire({\n            allowOutsideClick: false\n          });\n          swal.showLoading();\n          axios(config).then(res => {\n            var data = res.data;\n            if (data && data.success) {\n              alert('資料已成功清除');\n            } else {\n              alert(data.message);\n            }\n          }).catch(err => {\n            console.log(err);\n            alert(\"系統忙碌中，請稍後再試\");\n          }).finally(() => {\n            swal.close();\n          });\n        }\n      });\n    },\n    seePopUp(val) {\n      this.dialog = true;\n      this.popupIconType = 'icon' + val;\n      this.popupItem = val;\n    },\n    // 開啟相機，取得QR Code內容\n    getQRCodeData() {\n      this.dialog = false;\n      liff.scanCodeV2().then(result => {\n        this.form.scanning = result.value;\n        // swal.fire({\n        //   text: JSON.stringify(result),\n        //   allowOutsideClick: false\n        // })\n      }).catch(error => {\n        swal.fire({\n          text: JSON.stringify(error),\n          allowOutsideClick: false\n        });\n        // console.log(\"error\", error);\n      });\n    },\n\n    // 驗證表單\n    validate() {\n      this.$refs.form.validate();\n      if (this.$refs.form.validate()) {\n        this.ParentData();\n      }\n    },\n    ParentData() {\n      this.$emit(\"getParentData\", this.form);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}