{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nimport liff from \"@line/liff\";\nimport swal from \"sweetalert2\";\nimport popup from \"./components/popup\";\nimport store from \"./store/tags\";\n// import { fail } from \"assert\";\n// import {getSellerInvoiceVerifyResult} from './api/app';\nexport default {\n  name: \"App\",\n  components: {\n    popup\n  },\n  data: () => ({\n    loading: true,\n    dateLine: new Date() < new Date(\"2023-04-20,23:59:59\"),\n    //活動結束時間\n    dialog: false,\n    showPopup: false,\n    popupIconType: \"Bill\",\n    popupItem: \"Bill\",\n    inv_index: \"\",\n    ////九宮格位置\n    inv_prize: \"\",\n    //獎品10點 30點 50點 null\n    inv_name: \"\",\n    //得獎內容\n    // inv_playGame: true, //是否玩過遊戲\n    showMenu: false,\n    sellerName: [],\n    //查詢指定通路發票\n    audit: false,\n    //指定通路發票審核\n    userInfo: [],\n    //取得使用者inviteCode:邀請碼、isAeMember:是否是會員、isDraw：是否玩輪盤、isInvoiceEnrollment:是否登入發票\n    lineProfile: \"\" //取得user資訊\n  }),\n\n  computed: {\n    appTags() {\n      //愛酷標籤\n      return store.state.appTags;\n    }\n  },\n  mounted() {\n    let _this = this;\n    liff.init({\n      // liffId: _this.liffId,\n      liffId: _this.$liffId,\n      withLoginOnExternalBrowser: true\n    }).then(() => {\n      //確認登入狀態\n      if (!liff.isLoggedIn()) {\n        //執行登入\n        liff.login({\n          redirectUri: location.href\n        });\n      } else {\n        // 新增邀請紀錄\n        // _this.addInvitationRecord()\n        //取得Line Token\n        _this.$SetAccessToken(liff.getAccessToken());\n        // User資訊\n        _this.getUserInfo();\n        //確認好友狀態\n        liff.getFriendship().then(async data => {\n          if (!data.friendFlag) {\n            swal.fire({\n              text: '請加入春風官方帳號好友',\n              allowOutsideClick: false\n            }).then(() => {\n              // 判斷是否是開發環境\n              window.location.href = _this.$$lineFriends;\n            });\n            // _this.showPopup = true\n            // 做一個popup，有顆按鈕可以導到加好友畫面\n          } else {\n            try {\n              //取得user資訊\n              _this.lineProfile = await liff.getProfile();\n            } catch (error) {\n              alert('忙碌中，請稍後再試');\n              console.error(error);\n            }\n          }\n        });\n      }\n    });\n    window.addEventListener(\"resize\", this.renderResize, true);\n  },\n  beforeDestroy() {\n    // 移除 監聽\n    window.addEventListener(\"resize\", this.renderResize, false);\n  },\n  methods: {\n    // 禁止手機橫拿\n    renderResize() {\n      if (window.orientation == 180 || window.orientation == 0) {\n        this.showPopup = false;\n      }\n      if (window.orientation == 90 || window.orientation == -90) {\n        this.showPopup = true;\n      }\n    },\n    getLoading(val) {\n      this.loading = val;\n    },\n    //使用者發票驗證結果\n    getSellerInvoiceVerifyResult() {\n      var me = this;\n      var config = {\n        method: \"get\",\n        headers: {\n          Authorization: `Bearer ${me.$accessToken}`\n        },\n        url: me.$apiUrl + \"/liff/GetDataTable_SellerInvoiceVerifyResult/7978B4EB00EB4F77998CA206E06E5A5C\"\n      };\n      swal.fire({\n        allowOutsideClick: false\n      });\n      swal.showLoading();\n      axios(config).then(res => {\n        var data = res.data;\n        if (data && data.success) {\n          me.sellerName = data.data ? JSON.parse(data.data) : [];\n          me.seePopUp(\"Bill\");\n        }\n      }).catch(err => {\n        console.log(err);\n        alert(\"系統忙碌中，請稍後再試\");\n      }).finally(() => {\n        swal.close();\n      });\n    },\n    // 顯示popup視窗\n    seePopUp(val) {\n      this.dialog = true;\n      this.popupIconType = \"icon\" + val;\n      this.popupItem = val;\n    },\n    //獲得使用者是否需要玩遊戲的資訊\n    getIsDraw() {\n      let me = this;\n      var config = {\n        method: \"get\",\n        headers: {\n          Authorization: `Bearer ${me.$accessToken}`\n        },\n        url: me.$apiUrl + \"/API/GetData_LatestInvoice/A2215DDFC6D841D894DF0AC91697364D\"\n      };\n      swal.fire({\n        allowOutsideClick: false\n      });\n      swal.showLoading();\n      axios(config).then(res => {\n        var data = res.data;\n        if (data && data.success) {\n          if (data.data != null) {\n            // 玩過遊戲\n            console.log('data.data.index', data.data.index);\n            me.inv_index = data.data.index;\n            me.inv_prize = data.data.prize;\n            me.inv_name = data.data.name;\n            me.$router.push({\n              name: \"gamPage\",\n              params: {\n                inv_index: me.inv_index,\n                inv_prize: me.inv_prize,\n                inv_name: me.inv_name\n              }\n            });\n          } else {\n            me.$router.push({\n              name: \"gamPage\"\n            });\n          }\n        } else {\n          alert(data.message);\n          // 登入發票\n          me.$router.push({\n            name: \"fromPage\"\n          });\n        }\n      }).catch(err => {\n        console.log(err);\n        alert(\"系統忙碌中，請稍後再試\");\n      }).finally(() => {\n        swal.close();\n      });\n    },\n    // 在line liff裡開網頁\n    goAeSHOP() {\n      liff.openWindow({\n        url: \"https://pse.is/4f5ggc\",\n        external: false\n      });\n    },\n    //取得使用者inviteCode:邀請碼、isAeMember:是否是會員、isDraw：是否玩輪盤、isInvoiceEnrollment:是否登入發票\n    getUserInfo() {\n      var me = this;\n      var config = {\n        method: \"post\",\n        headers: {\n          Authorization: `Bearer ${me.$accessToken}`\n        },\n        url: me.$apiUrl + \"/API/GetData_GetUserInfo/A222F382F75747AC9441E37081AF7A1F\",\n        data: new FormData()\n      };\n      var url = new URL(location.href);\n      // invitation_code 邀請碼\n      config.data.append(\"invitation_code\", new URLSearchParams(url.search).get(\"inviteCode\"));\n      swal.fire({\n        allowOutsideClick: false\n      });\n      swal.showLoading();\n      axios(config).then(res => {\n        var data = res.data;\n        if (data && data.success) {\n          this.userInfo = data.data;\n        } else {\n          alert(data.message);\n        }\n      }).catch(err => {\n        console.log(err);\n        alert(\"系統忙碌中，請稍後再試\");\n      }).finally(() => {\n        swal.close();\n      });\n    },\n    changeAeMember(val) {\n      this.$set(this.userInfo, \"isAeMember\", val);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}