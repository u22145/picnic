{"ast":null,"code":"import axios from \"axios\";\nimport swal from 'sweetalert2';\nimport popup from '../components/popup';\nimport store from '../store/tags';\nimport gam from '../store/gam';\nexport default {\n  name: 'gamPage',\n  props: ['inv_index', 'inv_prize', 'inv_name'],\n  components: {\n    popup\n  },\n  data() {\n    return {\n      index: 0,\n      //九宮格位置\n      prize: null,\n      //獎品10點 30點 50點 null\n      name: '',\n      //得獎內容\n      defaultConfig: {\n        gutter: '10px'\n      },\n      clickFinger: true,\n      round: true,\n      dialog: false,\n      popupIconType: '',\n      popupItem: '',\n      number: \"\"\n    };\n  },\n  computed: {\n    gamTags() {\n      //愛酷標籤\n      return store.state.gamTags;\n    },\n    blocks() {\n      //邊框設定\n      return gam.state.blocks;\n    },\n    prizes() {\n      //轉盤圖片設定\n      return gam.state.prizes;\n    },\n    buttons() {\n      //轉盤開始按鈕設定\n      return gam.state.buttons;\n    },\n    attractions() {\n      //轉盤開始按鈕設定\n      return gam.state.attractions;\n    }\n  },\n  mounted() {\n    // 從選單點選遊戲\n    this.prize = this.inv_prize;\n    this.name = this.inv_name;\n    this.index = this.inv_index;\n    if (this.inv_name != '' && this.inv_prize != null) {\n      this.seePopUp('Winning');\n    }\n    if (this.inv_prize == null) {\n      this.seePopUp('Thanks');\n    }\n  },\n  methods: {\n    // 顯示popup視窗\n    seePopUp(val) {\n      this.dialog = true;\n      this.popupIconType = 'icon' + val;\n      this.popupItem = val;\n    },\n    // 点击抽奖按钮会触发star回调\n    startCallback() {\n      this.clickFinger = false;\n      this.getPrize();\n      // 调用抽奖组件的play方法开始游戏\n      this.$refs.myLucky.play();\n      // 模拟调用接口异步抽奖\n      setTimeout(() => {\n        const index = this.index;\n        // 调用stop停止旋转并传递中奖索引\n        this.$refs.myLucky.stop(index);\n        this.endCallback();\n        //顯示得獎訊息彈窗\n        this.showPrize();\n      }, 3000);\n    },\n    // 抽奖结束会触发end回调\n    endCallback(prize) {\n      console.log(prize);\n    },\n    // 獲得獎項\n    getPrize() {\n      var me = this;\n      me.url = '/API/GetData_DrawPrize/8635309EEF564474B11CAEB66F3E5501';\n      var config = {\n        method: \"post\",\n        headers: {\n          Authorization: `Bearer ${me.$accessToken}`\n        },\n        url: me.$apiUrl + me.url\n      };\n      axios(config).then(res => {\n        var data = res.data;\n        if (data && data.success) {\n          console.log('data.data', data.data);\n          this.prize = data.data.prize;\n          this.name = data.data.name;\n          this.index = data.data.index;\n        }\n      }).catch(err => {\n        console.log(err);\n        alert(\"系統忙碌中，請稍後再試\");\n      }).finally(() => {\n        // swal.close();\n      });\n    },\n    // 顯示得獎訊息彈窗\n    showPrize() {\n      if (this.prize == null) {\n        this.round = false;\n        setTimeout(() => {\n          // 過2秒顯示銘謝惠顧\n          this.seePopUp('Thanks');\n          this.round = true;\n        }, 2000);\n      } else {\n        this.round = false;\n        setTimeout(() => {\n          // 過2秒顯示得獎資訊\n          this.seePopUp('Winning');\n          this.round = true;\n        }, 2000);\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}